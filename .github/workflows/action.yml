name: Lunch Bot

on:
  schedule:
    # -----------------------------------------------------------
    # [시간 설정 설명]
    # UTC 23:00 = 한국 시간(KST) 다음날 오전 08:00
    #
    # [요일 설정 설명]
    # UTC 기준 일요일(0) 밤 23시 -> 한국 월요일 아침 8시
    # UTC 기준 목요일(4) 밤 23시 -> 한국 금요일 아침 8시
    # 따라서 0-4 (일~목)로 설정합니다.
    # -----------------------------------------------------------
    - cron: '0 23 * * 0-4'

  # 수동으로 실행하고 싶을 때 누르는 버튼 기능
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install libraries
        # 봇이 작동하는 데 필요한 도구들을 설치합니다.
        run: |
          pip install selenium requests webdriver-manager

      - name: Run Bot
        env:
          # 깃허브 Secret에 저장된 슬랙 주소를 가져옵니다.
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          # (B) 둘 다 올라올 때까지 재시도 설정 (필요시 조절)
          MAX_ATTEMPTS: '12'
          RETRY_SLEEP_SEC: '300'   # 5분
          MAX_RUNTIME_MIN: '60'    # 최대 60분만 대기
        # -u 옵션은 로그를 지연 없이 바로 출력하라는 뜻입니다.
        run: python -u main.py
